language: objective-c

before_install:
- chmod +x .utility/post_result.sh
- wget http://clang-analyzer.llvm.org/downloads/checker-276.tar.bz2
- tar -xvjf checker-276.tar.bz2
- svn checkout http://coverstory.googlecode.com/svn/trunk/ "$HOME/coverstory-read-only"

script:
- xcodebuild build -project $HOME/coverstory-read-only/CoverStory.xcodeproj CONFIGURATION_BUILD_DIR="/Applications"
- xcodebuild clean test -sdk iphonesimulator -project Coveralls-iOS.xcodeproj -scheme ci -configuration Debug OBJROOT=coverage_report ONLY_ACTIVE_ARCH=NO GCC_INSTRUMENT_PROGRAM_FLOW_ARCS=YES GCC_GENERATE_TEST_COVERAGE_FILES=YES
- ./checker-276/scan-build -o analyzer_report xcodebuild -sdk iphonesimulator clean analyze 

after_success:
- pwd
- ls coverage_report | sed "s;^;`pwd`;"
- .utility/post_result.sh

env:
- secure: "v45pjcogHNfXQyopD7gJRWHem9MeNqfViwSANlGBVt1XD5LgKqKlFKnLmq9HN8F+neUSwxGGYx/+sF8okLi5ax5qqNQVy5JsNLPtIYXbiu6MWhy8EZ77TogANu4VNk3/QfTx29Cin+XzU81W4wXsFQzE9KG71wGo1TtmI663Yxo="
- secure: "Q5VwjdrUYPNylK1GTttE6EoD2cV7ycH3g0DIfSOr2WWpz5xNQYNHBP6EZ1V9xQz4jzB5zayFkPFzeGznBIt+fiLIby+iY/qGEUCMcC9QY10JltxDQCrhwCYbrYtA8UJDTgbOjtig43kswuIL0fBK0BIAL+4UPjSifPDBMYr/M1M="
  global:
    - APPNAME="Coveralls-iOS"
    - DESCRIPTION="Run test coverage and analyze"
